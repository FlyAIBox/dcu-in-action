# DAS：DCU 人工智能基础软件系统

DAS（DCU AI Software Stack，DCU 人工智能基础软件系统）是针对国产加速卡推出的一套完整的人工智能基础软件，包含基础算子层、框架工具层、扩展组件层，与国产加速卡基础硬件系统、DTK 开发工具栈、模型空间 Model Zoo 、镜像仓库等形成一套完整的国产加速卡人工智能软硬件生态体系。 依托DAS，支持国产加速卡在人工智能的全领域应用，如自然语言大模型、多模态大模型、MOE大模型、视觉大模型、通用模型、语音模型等，支持模型训练及推理落地，实现快速的国产加速卡人工智能应用迁移、开发及迭代。

![DAS架构.png](https://das.sourcefind.cn:55011/portal/api-admin/auth/MyFile?FileKey=/markdown/DAS架构.png_1743042219387.png)

# 一、基础算子层

该层主要提供定制化高级算子。融合算子库lightop，基于torch接入针对国产加速卡深度优化的可融合稀疏计算类算子；引入BLAS，DNN，RCCL等基础算子库进行计算和通信的优化，对于访存密集型算子，通过大量的手写融合算子提升性能，构建了lightop算子库；为了适应更灵活的开发及高级开发者，引入了CK算子模板库，支持tensor core指令，通过细粒度的tile级别运算模板化，提升算子性能，给高阶开发者提供了更灵活的算子开发模板，在AI编译器层面，整合了triton，XLA和TVM等AI编译组件用于算子生成，为flashattention、xformer、bitsandbytes等组件提供AI编译路线支持，为算子开发提供了更多的开发方式，最大化的利用硬件资源。已发布算子可以从光合开发者社区-DAS获取。

# 二、框架工具层

该层主要提供基于国产加速卡适配版的基础深度学习框架及开发工具，包含PyTorch、TensorFlow、JAX、Paddleh和OneFlow等、通用推理框架包含OnnxRuntime、MIGraphx和AITemplate等，为人工智能开发者提供基础的深度学习框架支撑。针对国产加速卡的快速组件适配工具FastPT，支持基于Torch的组件快速适配；快速精度检测工LayerCheck，通过单Layer层的精度检查，快速定位精度出问题的层，用于快速的精度检查及定位；图优化组件GraphRay，优化图后端，通过图算匹配快速找到最优的图执行路线，优化模型性能。同时还构建OpenDAS开源社区，其中包含了大量的经过适配优化的AI三方组件提供给高阶开发用户。已发布框架工具可以从光合开发者社区-DAS获取

# 三、扩展组件层

该层主要由通用训练组件、大模型训练组件及大模型推理组件组成，针对通用模型训练推理、大模型训练推理的不同计算访存特点，组合不同的优化手段，构建系统工程优化能力，以大模型训练为例，一方面适配deepspeed、megtatron等分布式框架，另一方面采用topo优化、多维组合并行、激活重计算等策略，实现大模型场景的全面覆盖，在大模型推理方向，在flashattention、flashdecoding、kv cache、pageattention等方向进行了针对性的适配优化，降低首字延时提高吞吐能力。 目前，通用训练组件包含支持国产加速卡的Apex、Vision、Audio、Mmcv和Dgl等组件，大模型训练组件包含DeepSpeed、FastMoe、Bitsandbytes、FlashAttention、





## DAS中框架组件版本号定义

当DAS产品中的框架和组件经过一段时间的迭代研发和测试，对外正式发布时，版本号的定义要符合外部版本号编码规则。 ![DAS版本号规范示意图.png](https://das.sourcefind.cn:55011/portal/api-admin/auth/MyFile?FileKey=/markdown/DAS版本号规范示意图.png_1742890387283.png)

- **基础版本号**：对于主流框架和适配组件，该三位版本号一般继承自官方正式发布的版本号，当官方没有正式发布版本时，我们将组件的初始版本定义为0.0.1。

- 扩展版本号

  ：+号后面是我们在das软件栈中自定义的框架和组件的扩展版本号，具体定义如下：

  - **das前缀**：表示这是 DAS 软件栈的一部分。
  - **优化次数**：每次软件规划版本发布时，发布的主流框架和组件都会在某个版本的dtk上完成一次优化适配。在基础版本号和dtk版本号不变的情况下，完成一次优化适配，则进行opt优化次数升级。
  - **dtk版本号**：表示软件适配的dtk版本，由两部分组成，第一部分为前缀：dtk，第二部分为dtk的版本数字，dtk25041表示dtk的25.04.1版本。

## DAS框架组件的版本号应用

下面介绍DAS版本号规范如何应用到DAS产品中的框架/组件的软件包标识。

DAS产品中框架/组件的软件包标识包含以下几个部分：

- wheel包： **框架/组件名称-框架/组件版本-适用python版本号-适用操作系统_适用系统架构.whl**

- run包 **框架/组件名称-框架/组件版本-适用python版本号-适用操作系统_适用系统架构.run**

  说明：黑色加粗部分为命名中必须包含的部分，各部分之间通过“-”连接。

**软件包标识示例**： vllm-0.6.2+das.opt3.dtk2504-cp310-cp310-manylinux_2_28_x86_64.whl 表示das软件栈中的该软件包是基于vllm-0.6.2版本进行第三次优化的版本，该版本已适配dtk 25.04版本，适用于Python 3.10，兼容不同的64位linux发行版且glibc版本为2.28。