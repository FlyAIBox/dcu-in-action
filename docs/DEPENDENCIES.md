# ğŸ“¦ DCU-in-Action ä¾èµ–ç®¡ç†æŒ‡å—

## æ¦‚è¿°

æœ¬é¡¹ç›®æä¾›äº†å¤šå±‚æ¬¡çš„ä¾èµ–ç®¡ç†æ–¹æ¡ˆï¼Œæ ¹æ®ä¸åŒçš„ä½¿ç”¨åœºæ™¯å’Œç¯å¢ƒéœ€æ±‚ï¼Œæä¾›æœ€ä¼˜åŒ–çš„ä¾èµ–é…ç½®ã€‚

## ğŸ“‹ ä¾èµ–æ–‡ä»¶è¯´æ˜

### 1. requirements.txt (æ ‡å‡†ä¾èµ–)
- **ç”¨é€”**: ç”Ÿäº§ç¯å¢ƒæ¨èçš„æ ‡å‡†ä¾èµ–é…ç½®
- **ç‰¹ç‚¹**: åŒ…å«æ ¸å¿ƒåŠŸèƒ½ï¼Œä½“ç§¯é€‚ä¸­ï¼Œå®‰è£…å¿«é€Ÿ
- **é€‚ç”¨åœºæ™¯**: 
  - ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
  - å¤§æ¨¡å‹è®­ç»ƒå’Œæ¨ç†
  - ä¸€èˆ¬å¼€å‘ä½¿ç”¨
- **åŒ…å«åŠŸèƒ½**:
  - PyTorchç”Ÿæ€ç³»ç»Ÿ (torch, transformers, tokenizers)
  - DCUä¸“ç”¨åŠ é€Ÿåº“ (lmslim, flash-attn, vllm, deepspeed)
  - WebæœåŠ¡æ¡†æ¶ (fastapi, uvicorn, gradio)
  - ç§‘å­¦è®¡ç®—åŸºç¡€ (numpy, scipy, pandas)
  - é…ç½®ç®¡ç†å’Œç›‘æ§å·¥å…·

### 2. requirements-full.txt (å®Œæ•´ä¾èµ–)
- **ç”¨é€”**: åŒ…å«æ‰€æœ‰åŠŸèƒ½æ¨¡å—çš„å®Œæ•´ä¾èµ–
- **ç‰¹ç‚¹**: åŠŸèƒ½é½å…¨ï¼Œæ”¯æŒæ‰€æœ‰ç‰¹æ€§
- **é€‚ç”¨åœºæ™¯**:
  - å¼€å‘ç¯å¢ƒ
  - ç ”ç©¶å’Œå®éªŒ
  - éœ€è¦å®Œæ•´åŠŸèƒ½çš„åœºæ™¯
- **é¢å¤–åŒ…å«**:
  - å¤šåª’ä½“å¤„ç† (pillow, librosa, opencv)
  - æ•°æ®åº“æ”¯æŒ (redis, sqlalchemy, pymongo)
  - äº‘æœåŠ¡é›†æˆ (boto3, aws-cli)
  - å¼€å‘è°ƒè¯•å·¥å…· (jupyter, ipython)
  - æ€§èƒ½åˆ†æå·¥å…·
  - åˆ†å¸ƒå¼è®¡ç®—æ¡†æ¶ (ray)

### 3. common/docker/requirements.txt (å®¹å™¨ç¯å¢ƒ)
- **ç”¨é€”**: Dockerå®¹å™¨åŒ–éƒ¨ç½²ä¼˜åŒ–é…ç½®
- **ç‰¹ç‚¹**: ç²¾ç®€ä½†åŠŸèƒ½å®Œæ•´ï¼Œé€‚åˆå®¹å™¨ç¯å¢ƒ
- **é€‚ç”¨åœºæ™¯**:
  - Dockeréƒ¨ç½²
  - Kubernetesé›†ç¾¤
  - äº‘åŸç”Ÿç¯å¢ƒ
- **ä¼˜åŒ–ç‰¹æ€§**:
  - ç§»é™¤å¼€å‘ä¸“ç”¨å·¥å…·
  - ä¿ç•™ç”Ÿäº§å¿…éœ€åŠŸèƒ½
  - ä¼˜åŒ–é•œåƒå¤§å°

## ğŸ› ï¸ å®‰è£…æ–¹å¼

### æ–¹å¼1: æ™ºèƒ½å®‰è£…è„šæœ¬ï¼ˆæ¨èï¼‰

```bash
# æ£€æŸ¥ç¯å¢ƒ
./scripts/install_requirements.sh --check

# æ ‡å‡†å®‰è£…ï¼ˆæ¨èï¼‰
./scripts/install_requirements.sh --mode standard

# å®Œæ•´å®‰è£…
./scripts/install_requirements.sh --mode full

# æœ€å°å®‰è£…
./scripts/install_requirements.sh --mode minimal

# Dockerç¯å¢ƒå®‰è£…
./scripts/install_requirements.sh --mode docker
```

#### å®‰è£…è„šæœ¬åŠŸèƒ½
- âœ… è‡ªåŠ¨ç¯å¢ƒæ£€æŸ¥ (Pythonç‰ˆæœ¬ã€ç³»ç»Ÿèµ„æºã€DCUè®¾å¤‡)
- âœ… æ™ºèƒ½ä¾èµ–ç®¡ç† (æ ¹æ®æ¨¡å¼é€‰æ‹©åˆé€‚çš„ä¾èµ–)
- âœ… DCUç‰¹å®šåŒ…æ£€æµ‹å’Œå®‰è£…
- âœ… å®‰è£…åéªŒè¯
- âœ… è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºå’Œé”™è¯¯å¤„ç†

### æ–¹å¼2: æ‰‹åŠ¨å®‰è£…

```bash
# æ ‡å‡†ä¾èµ–
pip install -r requirements.txt

# å®Œæ•´ä¾èµ–
pip install -r requirements-full.txt

# Dockerä¾èµ–
pip install -r common/docker/requirements.txt
```

## ğŸ”§ DCUç‰¹å®šä¾èµ–

### DCUä¼˜åŒ–åŒ…åˆ—è¡¨
ä»¥ä¸‹åŒ…éœ€è¦ä»æµ·å…‰å®˜æ–¹ä¸‹è½½é¡µé¢è·å–ï¼š

| åŒ…å | ç‰ˆæœ¬ | è¯´æ˜ |
|------|------|------|
| torch | 2.4.1+das.opt2.dtk2504 | DCUä¼˜åŒ–çš„PyTorch |
| lmslim | 0.2.1+das.dtk2504 | å¤§æ¨¡å‹æ¨ç†ä¼˜åŒ– |
| flash-attn | 2.6.1+das.opt4.dtk2504 | é«˜æ•ˆæ³¨æ„åŠ›æœºåˆ¶ |
| vllm | 0.6.2+das.opt3.dtk2504 | é«˜æ€§èƒ½æ¨ç†å¼•æ“ |
| deepspeed | 0.14.2+das.opt2.dtk2504 | åˆ†å¸ƒå¼è®­ç»ƒæ¡†æ¶ |
| triton | 3.0.0 | é«˜æ€§èƒ½è®¡ç®—å†…æ ¸ |

### å®‰è£…DCUåŒ…

```bash
# ä¸‹è½½å®˜æ–¹wheelæ–‡ä»¶å
pip install torch-2.4.1+das.opt2.dtk2504-cp310-cp310-manylinux_2_28_x86_64.whl
pip install lmslim-0.2.1+das.dtk2504-cp310-cp310-manylinux_2_28_x86_64.whl
# ... å…¶ä»–åŒ…
```

### è‡ªåŠ¨æ£€æµ‹å®‰è£…
æ™ºèƒ½å®‰è£…è„šæœ¬ä¼šè‡ªåŠ¨æ£€æµ‹å½“å‰ç›®å½•ä¸­çš„DCU wheelæ–‡ä»¶å¹¶å®‰è£…ï¼š

```bash
# å°†wheelæ–‡ä»¶æ”¾åˆ°é¡¹ç›®æ ¹ç›®å½•
ls *.whl
# è¿è¡Œå®‰è£…è„šæœ¬ï¼Œä¼šè‡ªåŠ¨æ£€æµ‹å¹¶å®‰è£…
./scripts/install_requirements.sh --mode standard
```

## ğŸ“Š ç‰ˆæœ¬ç®¡ç†

### ç‰ˆæœ¬é€‰æ‹©åŸåˆ™
1. **åŸºäºå®é™…ç¯å¢ƒ**: æ‰€æœ‰ç‰ˆæœ¬å·åŸºäºç”Ÿäº§ç¯å¢ƒpip listéªŒè¯
2. **å…¼å®¹æ€§ä¼˜å…ˆ**: ç¡®ä¿åŒ…ä¹‹é—´çš„ç‰ˆæœ¬å…¼å®¹æ€§
3. **æ€§èƒ½ä¼˜åŒ–**: é€‰æ‹©æ€§èƒ½æœ€ä¼˜çš„ç‰ˆæœ¬ç»„åˆ
4. **ç¨³å®šæ€§ä¿è¯**: é€‰æ‹©ç»è¿‡æµ‹è¯•éªŒè¯çš„ç¨³å®šç‰ˆæœ¬

### ç‰ˆæœ¬æ›´æ–°ç­–ç•¥
- å®šæœŸæ£€æŸ¥ä¾èµ–åŒ…æ›´æ–°
- åœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯æ–°ç‰ˆæœ¬å…¼å®¹æ€§
- é€æ­¥å‡çº§ï¼Œç¡®ä¿å‘åå…¼å®¹
- è®°å½•ç‰ˆæœ¬å˜æ›´å’Œæµ‹è¯•ç»“æœ

## ğŸš¨ å¸¸è§é—®é¢˜

### Q1: DCUç¯å¢ƒæ£€æµ‹å¤±è´¥
**é—®é¢˜**: æœªæ£€æµ‹åˆ°DCUè®¾å¤‡æ–‡ä»¶
**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ£€æŸ¥è®¾å¤‡æ–‡ä»¶
ls -la /dev/kfd /dev/dri

# æ£€æŸ¥é©±åŠ¨çŠ¶æ€
lsmod | grep amdgpu

# é‡æ–°å®‰è£…é©±åŠ¨æˆ–åœ¨æ¨¡æ‹Ÿæ¨¡å¼ä¸‹è¿è¡Œ
```

### Q2: ä¾èµ–åŒ…å†²çª
**é—®é¢˜**: åŒ…ç‰ˆæœ¬å†²çªæˆ–å®‰è£…å¤±è´¥
**è§£å†³æ–¹æ¡ˆ**:
```bash
# æ¸…ç†pipç¼“å­˜
pip cache purge

# å¼ºåˆ¶é‡æ–°å®‰è£…
pip install --upgrade --force-reinstall torch transformers

# ä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ
python -m venv new_env
source new_env/bin/activate
```

### Q3: ç½‘ç»œå®‰è£…é—®é¢˜
**é—®é¢˜**: ä¸‹è½½é€Ÿåº¦æ…¢æˆ–è¿æ¥å¤±è´¥
**è§£å†³æ–¹æ¡ˆ**:
```bash
# ä½¿ç”¨å›½å†…é•œåƒ
pip install -i https://pypi.tuna.tsinghua.edu.cn/simple -r requirements.txt

# é…ç½®æ°¸ä¹…é•œåƒæº
pip config set global.index-url https://pypi.tuna.tsinghua.edu.cn/simple
```

### Q4: å†…å­˜ä¸è¶³
**é—®é¢˜**: å®‰è£…è¿‡ç¨‹ä¸­å†…å­˜ä¸è¶³
**è§£å†³æ–¹æ¡ˆ**:
```bash
# å¢åŠ swapç©ºé—´
sudo fallocate -l 4G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile

# æˆ–é€‰æ‹©æœ€å°å®‰è£…æ¨¡å¼
./scripts/install_requirements.sh --mode minimal
```

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### å®‰è£…ä¼˜åŒ–
- ä½¿ç”¨æœ¬åœ°ç¼“å­˜å‡å°‘é‡å¤ä¸‹è½½
- å¹¶è¡Œå®‰è£…å…¼å®¹çš„åŒ…
- é¢„ä¸‹è½½DCUç‰¹å®šåŒ…åˆ°æœ¬åœ°

### è¿è¡Œæ—¶ä¼˜åŒ–
- åˆç†è®¾ç½®ç¯å¢ƒå˜é‡
- é…ç½®DCUè®¾å¤‡å¯è§æ€§
- ä¼˜åŒ–å†…å­˜å’Œæ˜¾å­˜ä½¿ç”¨

## ğŸ”„ å‡çº§æŒ‡å—

### ä»æ—§ç‰ˆæœ¬å‡çº§
```bash
# å¤‡ä»½å½“å‰ç¯å¢ƒ
pip freeze > current_requirements.txt

# å¸è½½æ—§ç‰ˆæœ¬
pip uninstall -r current_requirements.txt -y

# å®‰è£…æ–°ç‰ˆæœ¬
./scripts/install_requirements.sh --mode standard

# éªŒè¯å‡çº§ç»“æœ
./scripts/install_requirements.sh --check
```

### å¢é‡æ›´æ–°
```bash
# æ›´æ–°ç‰¹å®šåŒ…
pip install --upgrade transformers torch

# æ›´æ–°æ‰€æœ‰åŒ…åˆ°å…¼å®¹ç‰ˆæœ¬
pip install --upgrade -r requirements.txt
```

## ğŸŒŸ æœ€ä½³å®è·µ

1. **ç¯å¢ƒéš”ç¦»**: å§‹ç»ˆä½¿ç”¨è™šæ‹Ÿç¯å¢ƒ
2. **ç‰ˆæœ¬é”å®š**: ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ç²¾ç¡®ç‰ˆæœ¬å·
3. **åˆ†å±‚å®‰è£…**: æ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„ä¾èµ–æ–‡ä»¶
4. **å®šæœŸæ£€æŸ¥**: å®šæœŸéªŒè¯ç¯å¢ƒçŠ¶æ€
5. **æ–‡æ¡£æ›´æ–°**: è®°å½•ç¯å¢ƒå˜æ›´å’Œé…ç½®

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- ğŸ“– æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£: [README.md](../README.md)
- ğŸ› æŠ¥å‘Šé—®é¢˜: [GitHub Issues](https://github.com/your-org/dcu-in-action/issues)
- ğŸ’¬ æŠ€æœ¯è®¨è®º: [GitHub Discussions](https://github.com/your-org/dcu-in-action/discussions)
- ğŸŒ å®˜æ–¹èµ„æº: [æµ·å…‰DCUå¼€å‘è€…ç¤¾åŒº](https://developer.sourcefind.cn/)

---

**ğŸ’¡ æç¤º**: å»ºè®®é¦–æ¬¡ä½¿ç”¨æ—¶å…ˆè¿è¡Œç¯å¢ƒæ£€æŸ¥ï¼Œç¡®ä¿ç³»ç»Ÿæ»¡è¶³åŸºæœ¬è¦æ±‚åå†è¿›è¡Œä¾èµ–å®‰è£…ã€‚ 