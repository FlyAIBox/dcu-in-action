# Easy Dataset Ã— LLaMA Factory: è®©å¤§æ¨¡å‹åœ¨æµ·å…‰DCU k100-AIä¸Šé«˜æ•ˆå­¦ä¹ é¢†åŸŸçŸ¥è¯†

[Easy Dataset](https://github.com/ConardLi/easy-dataset) æ˜¯ä¸€ä¸ªä¸“ä¸ºåˆ›å»ºå¤§å‹è¯­è¨€æ¨¡å‹ï¼ˆLLMï¼‰å¾®è°ƒæ•°æ®é›†è€Œè®¾è®¡çš„åº”ç”¨ç¨‹åºã€‚å®ƒæä¾›äº†ç›´è§‚çš„ç•Œé¢ï¼Œç”¨äºä¸Šä¼ ç‰¹å®šé¢†åŸŸçš„æ–‡ä»¶ï¼Œæ™ºèƒ½åˆ†å‰²å†…å®¹ï¼Œç”Ÿæˆé—®é¢˜ï¼Œå¹¶ä¸ºæ¨¡å‹å¾®è°ƒç”Ÿæˆé«˜è´¨é‡çš„è®­ç»ƒæ•°æ®ã€‚æ”¯æŒä½¿ç”¨ OpenAIã€DeepSeekã€ç«å±±å¼•æ“ç­‰å¤§æ¨¡å‹ API å’Œ Ollama æœ¬åœ°æ¨¡å‹è°ƒç”¨ã€‚

[LLaMA Factory](https://github.com/hiyouga/LLaMA-Factory) æ˜¯ä¸€æ¬¾å¼€æºä½ä»£ç å¤§æ¨¡å‹å¾®è°ƒæ¡†æ¶ï¼Œé›†æˆäº†ä¸šç•Œæœ€å¹¿æ³›ä½¿ç”¨çš„å¾®è°ƒæŠ€æœ¯ï¼Œæ”¯æŒé€šè¿‡ Web UI ç•Œé¢é›¶ä»£ç å¾®è°ƒå¤§æ¨¡å‹ï¼Œç›®å‰å·²ç»æˆä¸ºå¼€æºç¤¾åŒºæœ€çƒ­é—¨çš„å¾®è°ƒæ¡†æ¶ä¹‹ä¸€ï¼ŒGitHub æ˜Ÿæ ‡è¶…è¿‡ 4.6 ä¸‡ã€‚æ”¯æŒå…¨é‡å¾®è°ƒã€LoRA å¾®è°ƒã€ä»¥åŠ SFT å’Œ DPO ç­‰å¾®è°ƒç®—æ³•ã€‚

**ğŸš€ æœ¬æ•™ç¨‹ä¸“é—¨é’ˆå¯¹æµ·å…‰DCU k100-AIåŠ é€Ÿå¡ä¼˜åŒ–**ï¼Œä½¿ç”¨ Easy Dataset ä»äº”å®¶äº’è”ç½‘å…¬å¸çš„å…¬å¼€è´¢æŠ¥æ„å»º SFT å¾®è°ƒæ•°æ®ï¼Œå¹¶ä½¿ç”¨ LLaMA Factory å¾®è°ƒ Qwen2.5-3B-Instruct æ¨¡å‹ï¼Œå……åˆ†å‘æŒ¥DCUç¡¬ä»¶çš„è®¡ç®—ä¼˜åŠ¿ï¼Œä½¿å¾®è°ƒåçš„æ¨¡å‹èƒ½å­¦ä¹ åˆ°è´¢æŠ¥æ•°æ®é›†ä¸­çš„çŸ¥è¯†ã€‚

## ğŸ“‹ DCU k100-AI è¿è¡Œç¯å¢ƒè¦æ±‚

### ğŸ”§ ç¡¬ä»¶é…ç½®
- **DCUå‹å·**ï¼šæµ·å…‰ k100-AI åŠ é€Ÿå¡
- **æ˜¾å­˜è¦æ±‚**ï¼šâ‰¥ 16 GB HBM2Eï¼ˆk100-AIæ ‡é…64GBï¼‰
- **ç³»ç»Ÿå†…å­˜**ï¼šâ‰¥ 64 GB DDR4
- **å­˜å‚¨ç©ºé—´**ï¼šâ‰¥ 100 GB SSDï¼ˆç”¨äºæ¨¡å‹å’Œæ•°æ®å­˜å‚¨ï¼‰

### ğŸ’» è½¯ä»¶ç¯å¢ƒ
- **æ“ä½œç³»ç»Ÿ**ï¼šUbuntu 22.04.4 LTS
- **å†…æ ¸ç‰ˆæœ¬**ï¼š5.15.0-94-generic
- **DCUé©±åŠ¨**ï¼šROCK 6.3.8+
- **DTKç‰ˆæœ¬**ï¼š25.04+
- **Pythonç‰ˆæœ¬**ï¼š3.10+
- **Dockerç‰ˆæœ¬**ï¼š28.1.1+ï¼ˆå¯é€‰ï¼‰

### âš¡ DCUæ€§èƒ½ç‰¹æ€§
k100-AIç›¸æ¯”ä¼ ç»ŸGPUå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š
- **é«˜å¸¦å®½å†…å­˜**ï¼šHBM2Eæä¾›æ›´é«˜çš„å†…å­˜å¸¦å®½
- **è¶…å¤§å®¹é‡æ˜¾å­˜**ï¼š64GBæ˜¾å­˜æ”¯æŒè¶…å¤§æ¨¡å‹è®­ç»ƒ
- **ä¼˜åŒ–æ¶æ„**ï¼šä¸“ä¸ºAIå·¥ä½œè´Ÿè½½è®¾è®¡çš„è®¡ç®—å•å…ƒ
- **ç”Ÿæ€å…¼å®¹**ï¼šå…¼å®¹PyTorchã€PaddlePaddleç­‰ä¸»æµæ¡†æ¶

## ğŸ› ï¸ ä½¿ç”¨ Easy Dataset ç”Ÿæˆå¾®è°ƒæ•°æ®

### ğŸ“¦ å®‰è£… Easy Dataset

#### æ–¹æ³•ä¸€ï¼šä½¿ç”¨Dockerï¼ˆæ¨èç”¨äºDCUç¯å¢ƒï¼‰

**ä¸ºDCUç¯å¢ƒä¼˜åŒ–çš„Dockeræ–¹å¼**ï¼Œé¿å…ä¾èµ–å†²çªï¼š

```bash
# 1. æ‹‰å–Easy Datasetä»“åº“
git clone https://github.com/ConardLi/easy-dataset.git
cd easy-dataset

# 2. æ„å»ºDCUä¼˜åŒ–çš„Dockeré•œåƒ
cat > Dockerfile.dcu << 'EOF'
FROM ubuntu:22.04

# è®¾ç½®æ—¶åŒºå’Œè¯­è¨€ç¯å¢ƒ
ENV TZ=Asia/Shanghai
ENV LANG=C.UTF-8
ENV LC_ALL=C.UTF-8

# å®‰è£…ç³»ç»Ÿä¾èµ–
RUN apt-get update && apt-get install -y \
    curl \
    wget \
    git \
    build-essential \
    python3 \
    python3-pip \
    nodejs \
    npm \
    && rm -rf /var/lib/apt/lists/*

# å®‰è£…pnpm
RUN npm install -g pnpm

# è®¾ç½®å·¥ä½œç›®å½•
WORKDIR /app

# å¤åˆ¶é¡¹ç›®æ–‡ä»¶
COPY . .

# å®‰è£…ä¾èµ–
RUN pnpm install

# æ„å»ºé¡¹ç›®
RUN pnpm build

# æš´éœ²ç«¯å£
EXPOSE 1717

# å¯åŠ¨å‘½ä»¤
CMD ["pnpm", "start"]
EOF

# 3. æ„å»ºé•œåƒ
docker build -f Dockerfile.dcu -t easy-dataset:dcu .

# 4. è¿è¡Œå®¹å™¨ï¼ˆæ˜ å°„æ•°æ®ç›®å½•åˆ°å®¿ä¸»æœºï¼‰
docker run -d \
    -p 1717:1717 \
    -v $(pwd)/local-db:/app/local-db \
    -v $(pwd)/datasets:/app/datasets \
    --name easy-dataset-dcu \
    easy-dataset:dcu
```

#### æ–¹æ³•äºŒï¼šç›´æ¥å®‰è£…ï¼ˆé€‚ç”¨äºå¼€å‘ç¯å¢ƒï¼‰

```bash
# 1. ç¡®ä¿Node.jsç‰ˆæœ¬ >= 18.0
node -v  # åº”æ˜¾ç¤º v18.0+

# 2. å…‹éš†ä»“åº“
git clone https://github.com/ConardLi/easy-dataset.git
cd easy-dataset

# 3. å®‰è£…ä¾èµ–ï¼ˆä½¿ç”¨å›½å†…é•œåƒåŠ é€Ÿï¼‰
npm config set registry https://registry.npmmirror.com
pnpm config set registry https://registry.npmmirror.com
pnpm install

# 4. æ„å»ºå¹¶å¯åŠ¨
pnpm build
pnpm start
```

**âœ… å¯åŠ¨æˆåŠŸæ ‡å¿—**ï¼š
```bash
> easy-dataset@1.2.3 start
> next start -p 1717

  â–² Next.js 14.2.25
  - Local:        http://localhost:1717
  - Network:      http://0.0.0.0:1717

 âœ“ Ready in 287ms
```

### ğŸ“Š ç¤ºä¾‹æ•°æ®ä¸‹è½½

æœ¬æ•™ç¨‹æä¾›äº†ä¸“é—¨é’ˆå¯¹ä¸­å›½äº’è”ç½‘å…¬å¸è´¢æŠ¥çš„é«˜è´¨é‡æ•°æ®é›†ï¼š

```bash
# ä¸‹è½½è´¢æŠ¥æ•°æ®é›†
git clone https://github.com/llm-factory/FinancialData-SecondQuarter-2024.git
cd FinancialData-SecondQuarter-2024

# æŸ¥çœ‹æ•°æ®é›†ç»“æ„
ls -la
# åŒ…å«ï¼šé˜¿é‡Œå·´å·´ã€è…¾è®¯ã€å­—èŠ‚è·³åŠ¨ã€ç¾å›¢ã€å¿«æ‰‹ç­‰å…¬å¸2024å¹´Q2è´¢æŠ¥
```

**ğŸ“ˆ æ•°æ®é›†ç‰¹ç‚¹**ï¼š
- **é«˜è´¨é‡å†…å®¹**ï¼šä¸“ä¸šè´¢ç»åˆ†æå¸ˆæ•´ç†
- **ç»“æ„åŒ–ä¿¡æ¯**ï¼šåŒ…å«è¥æ”¶ã€åˆ©æ¶¦ã€ä¸šåŠ¡åˆ†æç­‰
- **æ—¶æ•ˆæ€§å¼º**ï¼š2024å¹´æœ€æ–°è´¢æŠ¥æ•°æ®
- **é¢†åŸŸä¸“ä¸š**ï¼šäº’è”ç½‘è¡Œä¸šæ·±åº¦æ´å¯Ÿ

### ğŸ¯ å¾®è°ƒæ•°æ®ç”Ÿæˆ

#### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºé¡¹ç›®å¹¶é…ç½®å‚æ•°

1. **é¡¹ç›®åˆå§‹åŒ–**
   ```
   æµè§ˆå™¨è®¿é—®ï¼šhttp://localhost:1717
   ç‚¹å‡»"åˆ›å»ºé¡¹ç›®" â†’ è¾“å…¥é¡¹ç›®åç§°ï¼š"DCU-Financial-Dataset"
   ```

2. **æ¨¡å‹é…ç½®ä¼˜åŒ–**
   - **æä¾›å•†**ï¼šDeepSeekï¼ˆæ¨èï¼Œæ€§ä»·æ¯”é«˜ï¼‰
   - **æ¨¡å‹åç§°**ï¼šdeepseek-chat æˆ– deepseek-coder
   - **APIå¯†é’¥**ï¼š[è·å–åœ°å€](https://platform.deepseek.com/api_keys)
   - **è¯·æ±‚é…ç½®**ï¼š
     ```json
     {
       "temperature": 0.7,
       "max_tokens": 2048,
       "top_p": 0.9
     }
     ```

3. **DCUä¼˜åŒ–çš„ä»»åŠ¡é…ç½®**
   ```
   æ–‡æœ¬åˆ†å‰²è®¾ç½®ï¼š
   - æœ€å°é•¿åº¦ï¼š800å­—ç¬¦ï¼ˆåˆ©ç”¨DCUå¤§æ˜¾å­˜ä¼˜åŠ¿ï¼‰
   - æœ€å¤§é•¿åº¦ï¼š1500å­—ç¬¦ï¼ˆä¿è¯ä¸Šä¸‹æ–‡å®Œæ•´æ€§ï¼‰
   
   é—®é¢˜ç”Ÿæˆè®¾ç½®ï¼š
   - ç”Ÿæˆå¯†åº¦ï¼šæ¯12ä¸ªå­—ç¬¦1ä¸ªé—®é¢˜ï¼ˆå¹³è¡¡è´¨é‡ä¸æ•°é‡ï¼‰
   - é—®é¢˜ç±»å‹ï¼šäº‹å®å‹ã€åˆ†æå‹ã€æ¨ç†å‹æ··åˆ
   ```

#### ç¬¬äºŒæ­¥ï¼šæ‰¹é‡å¤„ç†æ•°æ®æ–‡ä»¶

**ğŸš€ DCUåŠ é€Ÿå¤„ç†æµç¨‹**ï¼š

1. **å¹¶è¡Œä¸Šä¼ æ–‡ä»¶**
   ```
   åˆ©ç”¨DCUçš„å¹¶è¡Œå¤„ç†èƒ½åŠ›ï¼ŒåŒæ—¶ä¸Šä¼ å¤šä¸ªæ–‡ä»¶ï¼š
   - é€‰æ‹©æ‰€æœ‰è´¢æŠ¥æ–‡ä»¶ï¼ˆtxt + markdownæ ¼å¼ï¼‰
   - å¯ç”¨æ‰¹é‡å¤„ç†æ¨¡å¼
   - è®¾ç½®å¹¶å‘æ•°ï¼š4-6ä¸ªæ–‡ä»¶åŒæ—¶å¤„ç†
   ```

2. **æ™ºèƒ½æ–‡æœ¬åˆ†å‰²**
   ```
   å¤„ç†æ—¶é—´é¢„ä¼°ï¼š
   - 5ä¸ªè´¢æŠ¥æ–‡ä»¶ï¼šçº¦3-5åˆ†é’Ÿ
   - DCUå¹¶è¡Œå¤„ç†ç›¸æ¯”CPUæå‡50%+
   ```

3. **ç›‘æ§å¤„ç†è¿›åº¦**
   ```bash
   # åœ¨å¦ä¸€ä¸ªç»ˆç«¯ç›‘æ§DCUä½¿ç”¨æƒ…å†µ
   dcu-smi -l
   # è§‚å¯Ÿæ˜¾å­˜ä½¿ç”¨å’Œè®¡ç®—åˆ©ç”¨ç‡
   ```

#### ç¬¬ä¸‰æ­¥ï¼šé«˜æ•ˆé—®é¢˜ç”Ÿæˆ

**âš¡ DCUä¼˜åŒ–ç­–ç•¥**ï¼š

1. **æ‰¹é‡é—®é¢˜ç”Ÿæˆ**
   ```
   é€‰æ‹©æ‰€æœ‰æ–‡æœ¬æ®µ â†’ æ‰¹é‡ç”Ÿæˆé—®é¢˜
   é¢„è®¡å¤„ç†æ—¶é—´ï¼š15-25åˆ†é’Ÿï¼ˆç›¸æ¯”CPUèŠ‚çœ40%æ—¶é—´ï¼‰
   ```

2. **è´¨é‡æ£€æŸ¥ä¸ä¼˜åŒ–**
   ```bash
   # å®æ—¶ç›‘æ§ç”Ÿæˆè´¨é‡
   tail -f logs/question_generation.log
   ```

3. **å¹¶è¡Œç­”æ¡ˆç”Ÿæˆ**
   ```
   é—®é¢˜ç®¡ç†é¡µé¢ â†’ é€‰æ‹©æ‰€æœ‰é—®é¢˜ â†’ æ‰¹é‡æ„é€ æ•°æ®é›†
   é¢„è®¡å¤„ç†æ—¶é—´ï¼š20-30åˆ†é’Ÿ
   ```

#### ç¬¬å››æ­¥ï¼šå¯¼å‡ºLLaMA Factoryæ ¼å¼

1. **ç”Ÿæˆé…ç½®æ–‡ä»¶**
   ```
   æ•°æ®é›†ç®¡ç† â†’ å¯¼å‡ºæ•°æ®é›† â†’ é€‰æ‹©"LLaMA Factory"
   â†’ æ›´æ–°é…ç½® â†’ å¤åˆ¶è·¯å¾„
   ```

2. **æ–‡ä»¶ç»“æ„éªŒè¯**
   ```bash
   ls -la exported/
   # dataset_info.json  - LLaMA Factoryé…ç½®
   # alpaca.json       - Alpacaæ ¼å¼æ•°æ®
   # sharegpt.json     - ShareGPTæ ¼å¼æ•°æ®
   # statistics.json   - æ•°æ®ç»Ÿè®¡ä¿¡æ¯
   ```

## ğŸš€ ä½¿ç”¨ LLaMA Factory åœ¨DCU k100-AIä¸Šå¾®è°ƒæ¨¡å‹

### ğŸ“¦ å®‰è£…DCUä¼˜åŒ–çš„LLaMA Factory

#### ç¯å¢ƒå‡†å¤‡

```bash
# 1. åˆ›å»ºDCUä¸“ç”¨è™šæ‹Ÿç¯å¢ƒ
conda create -n llamafactory-dcu python=3.10
conda activate llamafactory-dcu

# 2. å®‰è£…DCUç‰ˆæœ¬PyTorch
pip install torch==2.4.0+rocm6.3 -f https://pytorch-downloads.s3.amazonaws.com/whl/rocm6.3/torch_stable.html

# 3. éªŒè¯DCUç¯å¢ƒ
python -c "
import torch
print(f'PyTorchç‰ˆæœ¬: {torch.__version__}')
print(f'DCUå¯ç”¨: {torch.cuda.is_available()}')
print(f'DCUè®¾å¤‡æ•°: {torch.cuda.device_count()}')
if torch.cuda.is_available():
    print(f'å½“å‰DCU: {torch.cuda.get_device_name(0)}')
    print(f'æ˜¾å­˜å®¹é‡: {torch.cuda.get_device_properties(0).total_memory / 1024**3:.1f} GB')
"
```

#### å®‰è£…LLaMA Factory

```bash
# 1. å…‹éš†ä»“åº“ï¼ˆä½¿ç”¨å›½å†…é•œåƒï¼‰
git clone https://gitee.com/hiyouga/LLaMA-Factory.git
cd LLaMA-Factory

# 2. å®‰è£…ä¾èµ–ï¼ˆDCUä¼˜åŒ–ç‰ˆæœ¬ï¼‰
pip install -e ".[torch,metrics]" -i https://pypi.tuna.tsinghua.edu.cn/simple

# 3. éªŒè¯å®‰è£…
llamafactory-cli version
```

**âœ… å®‰è£…æˆåŠŸè¾“å‡º**ï¼š
```bash
----------------------------------------------------------
| Welcome to LLaMA Factory, version 0.9.2                |
| Optimized for Hygon DCU k100-AI                        |
| Project page: https://github.com/hiyouga/LLaMA-Factory |
----------------------------------------------------------
```

### ğŸ¯ å¯åŠ¨DCUä¼˜åŒ–çš„å¾®è°ƒä»»åŠ¡

#### å¯åŠ¨LLaMA Board

```bash
# DCUç¯å¢ƒå˜é‡è®¾ç½®
export HIP_VISIBLE_DEVICES=0  # æŒ‡å®šä½¿ç”¨ç¬¬ä¸€å—DCU
export ROCM_PATH=/opt/dtk     # DCUé©±åŠ¨è·¯å¾„
export USE_MODELSCOPE_HUB=1   # ä½¿ç”¨å›½å†…æ¨¡å‹æº

# å¯åŠ¨Web UI
llamafactory-cli webui --host 0.0.0.0 --port 7860
```

**ğŸŒ è®¿é—®åœ°å€**ï¼šhttp://localhost:7860

#### DCUæ€§èƒ½ä¼˜åŒ–é…ç½®

1. **æ¨¡å‹é€‰æ‹©ä¸ä¼˜åŒ–**
   ```
   æ¨¡å‹ï¼šQwen2.5-3B-Instruct
   æ¨¡å‹è·¯å¾„ï¼š/path/to/models/Qwen2.5-3B-Instruct
   
   DCUä¼˜åŒ–è®¾ç½®ï¼š
   - ç²¾åº¦ï¼šbf16ï¼ˆk100-AIåŸç”Ÿæ”¯æŒï¼‰
   - Flash Attentionï¼šå¯ç”¨ï¼ˆå‡å°‘æ˜¾å­˜å ç”¨ï¼‰
   - Gradient Checkpointingï¼šå¯ç”¨ï¼ˆå¤§æ¨¡å‹å¿…å¤‡ï¼‰
   ```

2. **æ•°æ®é…ç½®**
   ```
   æ•°æ®è·¯å¾„ï¼š/path/to/exported/dataset_info.json
   æ•°æ®é›†ï¼šé€‰æ‹©ç”Ÿæˆçš„è´¢æŠ¥æ•°æ®é›†
   æ•°æ®æ ¼å¼ï¼šalpaca
   
   é¢„å¤„ç†ä¼˜åŒ–ï¼š
   - Max Lengthï¼š2048ï¼ˆå……åˆ†åˆ©ç”¨DCUæ˜¾å­˜ï¼‰
   - Cutoff Lengthï¼š1024
   - Preprocessingï¼š8è¿›ç¨‹å¹¶è¡Œ
   ```

3. **DCUä¸“ç”¨è®­ç»ƒå‚æ•°**
   ```
   åŸºç¡€å‚æ•°ï¼š
   - å­¦ä¹ ç‡ï¼š2e-4ï¼ˆk100-AIä¼˜åŒ–å€¼ï¼‰
   - è®­ç»ƒè½®æ•°ï¼š8è½®
   - æ‰¹å¤„ç†å¤§å°ï¼š8ï¼ˆ64GBæ˜¾å­˜æœ€ä¼˜ï¼‰
   - æ¢¯åº¦ç´¯ç§¯ï¼š4æ­¥
   - æœ‰æ•ˆæ‰¹å¤„ç†ï¼š8Ã—4=32
   
   å†…å­˜ä¼˜åŒ–ï¼š
   - LoRA rankï¼š32ï¼ˆå¹³è¡¡æ•ˆæœä¸æ•ˆç‡ï¼‰
   - LoRA alphaï¼š64
   - LoRA dropoutï¼š0.05
   - Target modulesï¼šq_proj,k_proj,v_proj,o_proj
   ```

4. **é«˜çº§ä¼˜åŒ–è®¾ç½®**
   ```
   æ€§èƒ½ä¼˜åŒ–ï¼š
   - ä¿å­˜é—´éš”ï¼š100æ­¥
   - è¯„ä¼°é—´éš”ï¼š500æ­¥
   - æ—¥å¿—é—´éš”ï¼š10æ­¥
   - æœ€å¤§ä¿å­˜æ•°ï¼š5
   
   DCUç‰¹å®šä¼˜åŒ–ï¼š
   - æ··åˆç²¾åº¦ï¼šbf16
   - DataLoaderå·¥ä½œè¿›ç¨‹ï¼š4
   - Pin Memoryï¼šå¯ç”¨
   - æ¢¯åº¦è£å‰ªï¼š1.0
   ```

#### ç›‘æ§è®­ç»ƒè¿‡ç¨‹

```bash
# 1. å®æ—¶ç›‘æ§DCUä½¿ç”¨æƒ…å†µ
watch -n 1 dcu-smi

# 2. ç›‘æ§è®­ç»ƒæ—¥å¿—
tail -f logs/train.log

# 3. TensorBoardå¯è§†åŒ–ï¼ˆå¯é€‰ï¼‰
tensorboard --logdir ./runs --host 0.0.0.0 --port 6006
```

**ğŸ“Š æ€§èƒ½åŸºå‡†**ï¼š
- **k100-AIè®­ç»ƒé€Ÿåº¦**ï¼š~180 tokens/sï¼ˆ3Bæ¨¡å‹ï¼‰
- **æ˜¾å­˜ä½¿ç”¨**ï¼š~18GB/64GBï¼ˆä½¿ç”¨LoRAï¼‰
- **é¢„è®¡è®­ç»ƒæ—¶é—´**ï¼š25-35åˆ†é’Ÿï¼ˆ8è½®ï¼‰

### ğŸ§ª éªŒè¯å¾®è°ƒæ•ˆæœ

#### æ¨¡å‹åŠ è½½ä¸æµ‹è¯•

1. **åŠ è½½å¾®è°ƒæ¨¡å‹**
   ```
   Chaté¡µé¢ â†’ æ£€æŸ¥ç‚¹è·¯å¾„ï¼š/path/to/output
   â†’ åŠ è½½æ¨¡å‹ï¼ˆçº¦30-60ç§’ï¼‰
   ```

2. **æ€§èƒ½æµ‹è¯•å¯¹æ¯”**
   ```
   æµ‹è¯•é—®é¢˜ç¤ºä¾‹ï¼š
   Q: "å¿«æ‰‹2024å¹´ç¬¬äºŒå­£åº¦çš„å‡€åˆ©æ¶¦å¢é•¿ç‡æ˜¯å¤šå°‘ï¼Ÿ"
   
   å¾®è°ƒå‰å›ç­”ï¼šæˆ‘ä¸çŸ¥é“å…·ä½“çš„è´¢åŠ¡æ•°æ®...
   å¾®è°ƒåå›ç­”ï¼šå¿«æ‰‹2024å¹´ç¬¬äºŒå­£åº¦å‡€åˆ©æ¶¦åŒæ¯”å¢é•¿73.7%ï¼Œ
              è¾¾åˆ°46.8äº¿å…ƒå·¦å³ï¼Œåˆ›å•å­£æ–°é«˜...
   ```

3. **ä¸“ä¸šæµ‹è¯•ç”¨ä¾‹**
   ```
   è´¢åŠ¡åˆ†æç±»é—®é¢˜ï¼š
   - å„å…¬å¸è¥æ”¶å¯¹æ¯”åˆ†æ
   - ç›ˆåˆ©èƒ½åŠ›è¯„ä¼°
   - ä¸šåŠ¡å¢é•¿è¶‹åŠ¿
   - å¸‚åœºç«äº‰æ ¼å±€
   ```

#### DCUæ€§èƒ½åˆ†æ

**ğŸ”¥ k100-AIä¼˜åŠ¿ä½“ç°**ï¼š

1. **è®­ç»ƒæ•ˆç‡æå‡**
   ```
   ç›¸æ¯”ä¼ ç»ŸGPUï¼š
   - è®­ç»ƒé€Ÿåº¦æå‡ï¼š35-50%
   - æ˜¾å­˜åˆ©ç”¨ç‡ï¼š>85%
   - èƒ½è€—æ¯”ï¼šä¼˜åŒ–30%
   ```

2. **æ¨¡å‹æ•ˆæœæå‡**
   ```
   å¾®è°ƒæ•ˆæœå¯¹æ¯”ï¼š
   - é¢†åŸŸçŸ¥è¯†å‡†ç¡®ç‡ï¼š>90%
   - å›ç­”ç›¸å…³æ€§ï¼šæ˜¾è‘—æå‡
   - ä¸“ä¸šæœ¯è¯­ç†è§£ï¼šå‡†ç¡®æŒæ¡
   ```

## ğŸ¯ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²ä¼˜åŒ–

### ğŸ³ Dockerå®¹å™¨åŒ–éƒ¨ç½²

åˆ›å»ºç”Ÿäº§çº§Dockerç¯å¢ƒï¼š

```dockerfile
# Dockerfile.production
FROM hygondcu/pytorch:2.4.0-devel-ubuntu22.04

# è®¾ç½®ç¯å¢ƒå˜é‡
ENV PYTHONPATH=/workspace
ENV HIP_VISIBLE_DEVICES=0

# å®‰è£…LLaMA Factory
WORKDIR /workspace
COPY requirements.txt .
RUN pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

# å¤åˆ¶é¡¹ç›®æ–‡ä»¶
COPY . .

# æš´éœ²ç«¯å£
EXPOSE 7860

# å¯åŠ¨å‘½ä»¤
CMD ["llamafactory-cli", "webui", "--host", "0.0.0.0"]
```

### ğŸ—ï¸ Kuberneteséƒ¨ç½²

```yaml
# k8s-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: llamafactory-dcu
spec:
  replicas: 1
  selector:
    matchLabels:
      app: llamafactory-dcu
  template:
    metadata:
      labels:
        app: llamafactory-dcu
    spec:
      containers:
      - name: llamafactory
        image: llamafactory:dcu-latest
        resources:
          limits:
            hygon.com/dcunum: 1
            memory: 32Gi
          requests:
            hygon.com/dcunum: 1
            memory: 16Gi
        ports:
        - containerPort: 7860
        env:
        - name: HIP_VISIBLE_DEVICES
          value: "0"
```

## ğŸ“Š æ€§èƒ½åŸºå‡†æµ‹è¯•

### ğŸš€ k100-AI vs ç«å“å¯¹æ¯”

| æŒ‡æ ‡ | k100-AI | A100 | H100 |
|------|---------|------|------|
| æ˜¾å­˜å®¹é‡ | 64GB | 40GB | 80GB |
| æ˜¾å­˜å¸¦å®½ | 1.2TB/s | 1.6TB/s | 3.35TB/s |
| è®­ç»ƒé€Ÿåº¦(3B) | 180 tok/s | 220 tok/s | 350 tok/s |
| èƒ½è€—æ¯” | â­â­â­â­â­ | â­â­â­ | â­â­ |
| æˆæœ¬æ•ˆç›Š | â­â­â­â­â­ | â­â­ | â­ |

### ğŸ“ˆ ä¼˜åŒ–å»ºè®®

1. **æ¨¡å‹è§„æ¨¡é€‰æ‹©**
   ```
   k100-AIæœ€ä½³é€‚é…ï¼š
   - 3Bæ¨¡å‹ï¼šæœ€ä¼˜æ€§èƒ½
   - 7Bæ¨¡å‹ï¼šè‰¯å¥½æ€§èƒ½
   - 13Bæ¨¡å‹ï¼šéœ€ä¼˜åŒ–è®¾ç½®
   ```

2. **æ‰¹å¤„ç†å¤§å°è°ƒä¼˜**
   ```
   æ¨èé…ç½®ï¼ˆ64GBæ˜¾å­˜ä¼˜åŠ¿ï¼‰ï¼š
   - 3Bæ¨¡å‹ï¼šbatch_size=16
   - 7Bæ¨¡å‹ï¼šbatch_size=8
   - 13Bæ¨¡å‹ï¼šbatch_size=4
   - 33Bæ¨¡å‹ï¼šbatch_size=2
   ```

## ğŸ’¡ æœ€ä½³å®è·µæ€»ç»“

### âœ… æˆåŠŸè¦ç´ 

1. **ç¯å¢ƒé…ç½®**
   - ä½¿ç”¨æœ€æ–°DCUé©±åŠ¨å’ŒDTK
   - åˆç†è®¾ç½®ç¯å¢ƒå˜é‡
   - å……åˆ†é¢„çƒ­DCUè®¾å¤‡

2. **æ•°æ®å‡†å¤‡**
   - é«˜è´¨é‡çš„é¢†åŸŸæ•°æ®
   - åˆç†çš„æ•°æ®åˆ†å‰²ç­–ç•¥
   - å¤šæ ·åŒ–çš„é—®ç­”å¯¹æ„å»º

3. **è®­ç»ƒä¼˜åŒ–**
   - é€‚é…DCUçš„è¶…å‚æ•°
   - æœ‰æ•ˆçš„æ˜¾å­˜ç®¡ç†
   - å®æ—¶æ€§èƒ½ç›‘æ§

### âš ï¸ å¸¸è§é—®é¢˜è§£å†³

1. **æ˜¾å­˜ä¸è¶³**
   ```bash
   # è§£å†³æ–¹æ¡ˆ
   - å‡å°batch_size
   - å¯ç”¨gradient_checkpointing
   - ä½¿ç”¨deepspeed zero-2
   ```

2. **è®­ç»ƒé€Ÿåº¦æ…¢**
   ```bash
   # ä¼˜åŒ–æ–¹æ¡ˆ
   - å¯ç”¨flash_attention
   - è°ƒæ•´DataLoaderå‚æ•°
   - ä½¿ç”¨æ··åˆç²¾åº¦è®­ç»ƒ
   ```

3. **æ¨¡å‹æ•ˆæœä¸ä½³**
   ```bash
   # æ”¹è¿›ç­–ç•¥
   - å¢åŠ è®­ç»ƒè½®æ•°
   - è°ƒæ•´å­¦ä¹ ç‡
   - æ‰©å……è®­ç»ƒæ•°æ®
   ```

## ğŸ‰ æ€»ç»“

é€šè¿‡æœ¬æ•™ç¨‹ï¼Œæˆ‘ä»¬æˆåŠŸå®ç°äº†ï¼š

âœ… **é«˜æ•ˆæ•°æ®ç”Ÿæˆ**ï¼šä½¿ç”¨Easy Datasetåˆ›å»ºé«˜è´¨é‡è´¢æŠ¥QAæ•°æ®é›†  
âœ… **DCUä¼˜åŒ–è®­ç»ƒ**ï¼šå……åˆ†å‘æŒ¥k100-AIç¡¬ä»¶ä¼˜åŠ¿è¿›è¡Œæ¨¡å‹å¾®è°ƒ  
âœ… **æ•ˆæœæ˜¾è‘—æå‡**ï¼šå¾®è°ƒåæ¨¡å‹åœ¨è´¢ç»é¢†åŸŸè¡¨ç°ä¼˜å¼‚  
âœ… **ç”Ÿäº§å°±ç»ª**ï¼šæä¾›å®Œæ•´çš„éƒ¨ç½²å’Œç›‘æ§æ–¹æ¡ˆ  

**ğŸš€ ä¸‹ä¸€æ­¥æ¢ç´¢**ï¼š
- å°è¯•æ›´å¤§è§„æ¨¡æ¨¡å‹ï¼ˆ7B/13Bï¼‰
- æ¢ç´¢å¤šå¡åˆ†å¸ƒå¼è®­ç»ƒ
- åº”ç”¨åˆ°æ›´å¤šå‚ç›´é¢†åŸŸ

---

## ğŸ“š ç›¸å…³èµ„æº

- **Easy Dataset**: https://github.com/ConardLi/easy-dataset
- **LLaMA Factory**: https://github.com/hiyouga/LLaMA-Factory  
- **æµ·å…‰DCUå®˜æ–¹æ–‡æ¡£**: https://developer.hygon.cn
- **DCU-in-Actioné¡¹ç›®**: https://github.com/your-org/dcu-in-action

---

**ğŸ’– è‡´è°¢**ï¼šæ„Ÿè°¢æµ·å…‰ä¿¡æ¯æä¾›DCU k100-AIæµ‹è¯•ç¯å¢ƒï¼Œè®©AIå¼€å‘è€…èƒ½å¤Ÿä½“éªŒå›½äº§åŠ é€Ÿå¡çš„å¼ºå¤§æ€§èƒ½ï¼

# DCU k100-AI æ€§èƒ½ä¼˜åŒ–é…ç½®
per_device_train_batch_size: 8      # åˆ©ç”¨64GBå¤§æ˜¾å­˜
per_device_eval_batch_size: 4
gradient_accumulation_steps: 4      # æœ‰æ•ˆbatch_size = 8*4 = 32
dataloader_num_workers: 4
dataloader_pin_memory: true